#!/bin/sh
#
# Script that retag and push test docker images to prd user
#

# exit if a command fails
set -e

DOCKER=$(which docker)

if [ "$DOCKER" = '' ]; then
    echo 'Docker is required\n'
    exit 1
fi

#
# LOGIN
#
LOGGED_IN=$( docker info | grep -q "Username: alphasocket" && echo "true")
if [ "$LOGGED_IN" != "true" ];
then 
    if [ ! -z "$DOCKER_PASSWORD" ] ;
    then
        # Automated push
        docker login -u "alphasocket" -p "$DOCKER_PASSWORD" docker.io;
    else
        docker login -u "alphasocket" docker.io;
    fi
fi

#
# RE-TAG the dev image to prd usr
#
docker tag 03192859189254/toolbox:fatal: Not a git repository (or any parent up to mount point /home)
Stopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set). \
    alphasocket/toolbox:fatal: Not a git repository (or any parent up to mount point /home)
Stopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).;

#
# PUSH
#
echo "#\n# Pushing image\n#\n"
docker push docker.io/alphasocket/toolbox:fatal: Not a git repository (or any parent up to mount point /home)
Stopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).;
exit $?